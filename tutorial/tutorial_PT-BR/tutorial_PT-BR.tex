\documentclass[a4paper, 11pt, twoside]{article}

\usepackage[brazilian]{babel} % Habilita o uso de portugues brasileiro
\usepackage{lmodern}
\usepackage[T1]{fontenc}

\usepackage[square, numbers, comma, sort&compress]{natbib} 
\usepackage{verbatim}  % Comment environment
\usepackage[margin=2.5cm]{geometry}
\usepackage{amsmath}	% Matrices
\usepackage{subfig}
\usepackage{graphicx}
\usepackage{url}
\usepackage{hyperref}
\usepackage{xcolor}
\usepackage{algorithm}
\usepackage{algpseudocode}
\usepackage[retainorgcmds]{IEEEtrantools}


% from https://www.overleaf.com/learn/latex/code_listing
\usepackage{textcomp}  % required for upticks in listings env
\usepackage{listings}
\definecolor{codegreen}{rgb}{0, 0.6, 0}
\definecolor{codegray}{rgb}{0.5, 0.5, 0.5}
\definecolor{codepurple}{rgb}{0.58, 0, 0.82}
\definecolor{backcolour}{rgb}{0.95, 0.95, 0.95}

\lstset{backgroundcolor=\color{backcolour},   
	commentstyle=\color{codegreen},
	keywordstyle=\color{magenta},
	numberstyle=\tiny\color{codegray},
	stringstyle=\color{codepurple},
	basicstyle=\ttfamily\footnotesize,
	breakatwhitespace=false,         
	breaklines=true,                 
	captionpos=b,                    
	keepspaces=true,                                 
	showspaces=false,                
	showstringspaces=false,
	showtabs=false,                  
	tabsize=4,
	upquote=true,
	frame=single,
	language=Python
}

\hypersetup{urlcolor=blue, colorlinks=true, linkcolor=blue, citecolor=blue}  % Colours hyperlinks in blue, but this can be distracting if there are many links.

% Use double bar for vector norm
\providecommand{\norm}[1]{\lVert#1\rVert}

% "upright" 'd' for integrals
\newcommand{\ud}{\,\mathrm{d}}


\author{Fabio Casagrande Hirono \\ \texttt{fchirono@gmail.com}}
\title{\texttt{amiet\_tools}: um pacote em Python para predição de ruído de interação turbulência-aerofólio\\\textcolor{red}{EM CONSTRUÇÃO}}
\date{Janeiro 2021}

\begin{document}
\maketitle

\begin{abstract}
	O pacote \verb|amiet_tools| (AmT), escrito em linguagem Python, é uma implementação do modelo analítico de Amiet \cite{Amiet75} para predição de ruído de interação turbulência-aerofólio, com extensões. As funções permitem o cálculo da flutuação de pressão na superfície do aerofólio (i.e. a distribuição da fonte acústica) gerado em resposta à turbulência incidente, e do campo acústico radiado por esta interação. A turbulência incidente pode ser uma única rajada senoidal, ou uma soma incoerente de rajadas com amplitudes definidas por um espectro energético. Outras funções includem a modelagem de efeitos de convecção e refração na propagação sonora para modelar medições acústicas realizadas em túneis de vento abertos ou fechados. Uma publicação de referência está disponível \cite{Casagrande_etal2020}, e o pacote pode ser encontrado através do link \url{https://github.com/fchirono/amiet_tools}.
\end{abstract}

% *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
\section{Introdução}

\subsection{Contexto}

O ruído gerado pela interação entre um escoamento turbulento e uma superfície sólida, tal como um aerofólio, é uma das principais fontes de ruído banda larga na indústria de aviação moderna. Apesar dos mecanismos físicos fundamentais desta fonte de ruído estarem bem estabelecidos, métodos eficientes para redução de ruído de interação turbulência-aerofólio ainda são objeto de estudos e pesquisas. Devido ao seu baixo custo computacional, diversos modelos analíticos são frequentemente adotados para analisar os comportamentos físicos fundamentais e escalas do problema. Entre os modelos analíticos mais populares para predição de ruído de aerofólio, o modelo de Amiet \cite{Amiet75} para um aerofólio do tipo placa plana em campo livre é frequentemente considerado um dos mais importantes devido a sua simplicidade formal e extensibilidade.

Em resumo, o modelo de Amiet decompõe um escoamento turbulento em uma soma de Fourier, onde cada componente constitui uma ``rajada'' senoidal, e calcula a flutuação de pressão - também denominada ``salto de pressão'' - distribuída sobre a superfície do aerofólio em resposta à interação com cada rajada. Seguindo a analogia acústica de Ffowcs Williams e Hawkings, a radiação acústica pode ser calculada usando uma distribuição de fontes tipo dipolo pontual sobre a superfície do aerofólio, cuja amplitude é dada pelo salto de pressão. O campo acústico radiado é então calculado através de uma integral de radiação, levando-se em conta os efeitos de convecção e/ou refração do som na propagação entre a fonte e o(s) observador(es).

Ao assumir que o aerofólio possui envergadura infinita, pode-se mostrar que uma única rajada senoidal será responsável por todo o ruído recebido por um observador distante. A expressão resultante desta simplificação relaciona a densidade espectral de potência (\emph{power spectral density} - PSD) do ruído visto pelo observador diretamente às propriedades do escoamento turbulento e à geometria do aerofólio, evitando assim o cálculo explícito da distribuição de fonte acústica sobre a superfície do aerofólio e da integral de radiação completa. Esta forma simplificada do modelo de Amiet é a mais popular, e frequentemente é suficiente para se obter tendências gerais do ruído radiado. 

Porém, tais aproximações podem ser simplórias demais para problemas mais avançados, tais como o cálculo explícito do campo acústico próximo ao aerofólio ou a inclusão de efeitos de envergadura finita. Sob estas condições, o modelo de Amiet requer o cálculo separado da distribuição de fontes e da integral de radiação, aumentando significativamente a complexidade do modelo de Amiet. Neste caso, é interessante buscar uma implementação de referência do modelo de Amiet completo, permitindo que os pesquisadores possam obter resultados confiáveis rapidamente e não perder tempo com detalhes de implementação.

Este documento busca introduzir o pacote \verb|amiet_tools| (abreviado por ``AmT''), uma implementação de referência do modelo de Amiet completo para ruído de interação turbulência-aerofólio \cite{Casagrande_etal2020}, e explicar o seu uso. O pacote AmT é desenvolvido em linguagem Python e disponibilizado com uma licença de código aberto, permitindo a sua distribuição, modificação e uso por diversos usuários em múltiplos sistemas operacionais. O pacote encontra-se hospedado na plataforma GitHub através do link:

\begin{itemize}
	\item \url{https://github.com/fchirono/amiet_tools} .
\end{itemize}


\subsection{Referências Teóricas Recomendadas}

Este documento não busca explicar completamente a teoria por trás do modelo de Amiet. Para mais detalhes e informações sobre modelo analítico completo, recomendamos que o leitor consulte as seguintes referências:

\begin{itemize}
	\item R. Amiet, ``\emph{Acoustic radiation from an airfoil in a turbulent stream}'', Journal of Sound and Vibration, Vol. 41, No. 4:407–420, 1975 \cite{Amiet75};
	
	\item G. Reboul, ``\emph{Modélisation du bruit à large bande de soufflante de turboréacteur}'', PhD Thesis, Laboratoire de Mécanique des Fluides et d’Acoustique - École Centrale de Lyon, Lyon - France, 2010 \cite{Reboul10};
	
	\item M. Roger, ``\emph{Broadband noise from lifting surfaces: Analytical modeling and experimental validation}'', in: R. Camussi (Ed.), ``\emph{Noise Sources in Turbulent Shear Flows: Fundamentals and Applications}'', Springer-Verlag, 2013 \cite{Roger13};
	
	\item L. de Santana, ``\emph{Semi-analytical methodologies for airfoil noise prediction}'', PhD Thesis, Faculty of Engineering Sciences - Katholieke Universiteit Leuven, Leuven, Belgium, 2015 \cite{deSantana2015};
	
	\item F. Casagrande Hirono, ``\emph{Far-Field Microphone Array Techniques for Acoustic Characterisation of Aerofoils}'', PhD Thesis, Institute of Sound and Vibration Research, University of Southampton, Southampton - UK, 2018 \cite{Casagrande18}.
\end{itemize}


\subsection{O modelo de Amiet}

Esta seção busca descrever os principais conceitos por trás do modelo de Amiet. O modelo requer como entrada as condições experimentais do problema: as propriedades do escoamento turbulento, a geometria do aerofólio, e a localização dos observadores no campo acústico. Todos os cálculos são realizados no domínio da frequência (isto é, assume-se que todas as variáveis acústicas oscilam harmonicamente), e a cada frequência de interesse são realizadas três etapas:

\begin{enumerate}
	\item Decomposição do escoamento turbulento em múltiplas rajadas senoidais, cada uma caracterizada por seu número de onda lateral $k_\psi$;
	\item Cálculo do ``salto'' de pressão $\Delta p$ sobre o aerofólio em resposta a cada rajada turbulenta;
	\item Cálculo do campo acústico radiado através de uma integral de radiação, levando em consideração efeitos de convecção e/ou refração na propagação do som.
\end{enumerate}


%Ao considerarmos a interação do aerofólio com uma rajada única, tanto a distribuição de pressão sobre o aerofólio quanto o ruído radiado a partir desta são determinísticos, isto é, coerentes: nesse caso, haverá interferência construtiva e destrutiva entre os sons gerados por cada ponto. Porém, as múltiplas rajadas que compõem um escoamento turbulento são incoerentes entre si, e a soma das contribuições de diferentes rajadas será um processo estocástico. Portanto, o ruído gerado também será de natureza estocástica, e deve ser analizado de forma probabilística através da função densidade espectral cruzada (\emph{cross spectral density} - CSD).

As condições experimentais do problema estão indicadas na Figura \ref{fig:experimental_setup}: um aerofólio do tipo placa plana retangular, de espessura infinitesimal, está imerso em um escoamento turbulento subsônico de velocidade $U_x$ e número Mach $M_x = U_x/c_0$ na direção $+x$. O aerofólio possui corda $c=2b$ e envergadura $L=2d$, e a origem do sistema de coordenadas é colocado no centro do aerofólio, com o eixo $+z$ perpendicular ao aerofólio (apontando ``fora da página'' na Fig. \ref{fig:experimental_setup}). Pontos no espaço ao redor do aerofólio são indicados por um vetor $\mathbf{r}=(x, y, z)$, e pontos na superfície do aerofólio são indicados com um caractere subescrito ``$_s$'', da forma $\mathbf{r}_s = (x_s, y_s, z_s)$. O aerofólio encontra-se no plano $z_s = 0$. A análise a seguir encontra-se no domínio da frequência angular $\omega = 2 \pi f$, e a dependência temporal implícita é da forma $e^{+j \omega t}$.

\begin{figure}[htbp]
	\centering
	\includegraphics[width=0.6\textwidth]{../figures/Oblique_Gust_aerofoil.pdf}
	\caption{Diagrama das condições experimentais}
	\label{fig:experimental_setup}
\end{figure}

\subsubsection{Interação com uma rajada única}

Um espectro contínuo de rajadas turbulentas senoidais ``congeladas'' move-se no plano $z=0$ com velocidade de convecção $U_x$, e cada rajada é definida por um par de números de onda hidrodinâmicos (isto é, vorticais) longitudinal e lateral $(k_\chi, k_\psi)$. Uma rajada única representa uma perturbação de velocidade vertical, conforme indicado na Figura \ref{fig:gust_airfoil_2D}, e é da forma

\begin{equation}
w(x, y, \omega) = \hat{w}_0(\kappa_\chi, k_\psi) e^{-j\kappa_\chi x} e^{-j k_\psi y },
\end{equation}

\noindent onde $\kappa_\chi = \omega/U_x$ é o número de onda longitudinal da rajada, associado unicamente à frequência do ruído radiado, e $\hat{w}_0$ é a amplitude desta rajada. %Note que o número de onda lateral $k_\psi$ pode assumir qualquer valor real em qualquer frequência, e portanto em problemas envolvendo múltiplas rajadas será necessário integrar a contribuição dos diferentes números de onda laterais a cada frequência.

\begin{figure}[htbp]
	\centering
	\includegraphics[width=0.8\textwidth]{../figures/gust_ProfGil_ITA_aula06.jpg}
	\caption{Diagrama 2D indicando uma perturbação de velocidade vertical $w(x, t)$ (``rajada'' turbulenta) interagindo com um aerofólio. (Figura reproduzida a partir dos materiais da disciplina \emph{AA-220 - Aerodinâmica Não Estacionária}, Prof. Dr. Roberto Gil Annes da Silva, ITA - \url{http://www.aer.ita.br/~gil/disciplinas/aa-220/aa2206.pdf}).}
	\label{fig:gust_airfoil_2D}
\end{figure}


Em resposta à incidência de uma única rajada turbulenta, haverá uma flutuação na pressão sobre a superfície do aerofólio, denominada aqui de ``salto'' de pressão $\Delta p$. Este salto de pressão será da forma

\begin{equation}
\Delta p(x_s, y_s, \omega) =  2 \pi \rho_0 \hat{w}_0(\kappa_\chi, k_\psi) \ g(x_s, \kappa_\chi, k_\psi) e^{-j k_\psi y_s},
\label{eq:DeltaP_SingleGust}
\end{equation}

\noindent onde $g$ é o salto de pressão não-dimensional sobre a corda $x_s$ devido a uma rajada $(\kappa_\chi, k_\psi)$.

Segundo a analogia de Ffowcs Williams e Hawkings, o ruído gerado por esta interação pode ser calculado usando uma distribuição equivalente de fontes pontuais tipo dipolo, com a flutuação de pressão $\Delta p$ sobre o aerofólio exercendo o papel de amplitude dos dipolos equivalentes. Analiticamente, a pressão acústica $p(\mathbf{r}, \omega)$ recebida por um observador no ponto $\mathbf{r} = (x, y, z)$ é dada por

\begin{equation}
	p(\mathbf{r}, \omega) = \int_{-d}^{+d} \int_{-b}^{+b} \Delta p(\mathbf{r}_s, \omega) \frac{\partial }{\partial z_s} G_{U_x}(\mathbf{r} | \mathbf{r}_s, \omega) \ud x_s \ud y_s,
\end{equation}

\noindent onde o termo $\partial G_{U_x}(\mathbf{r} | \mathbf{r}_s, \omega) / \partial z_s$ representa a função de transferência de uma fonte tipo dipolo localizada em $\mathbf{r}_s$ e o observador em $\mathbf{r}$, onde ambos estão imersos em um escoamento uniforme de velocidade $U_x$ e portanto inclui efeitos de convecção nas ondas acústicas. Se as condições experimentais adotam um túnel de vento aberto, esta função pode ser modificada para incluir efeitos de refração das ondas acústicas na camada cisalhante gerada entre o escoamento gerado pelo túnel e o ar estacionário ao redor deste.

Conforme descrito acima, a flutuação de pressão $\Delta p$ em resposta a uma única rajada turbulenta será completamente coerente - isto é, todos os pontos na superfície do aerofólio flutuarão perfeitamente em fase, de forma estatisticamente \emph{dependente}, e o campo acústico $p$ gerado por esta interação exibirá efeitos de interferência construtiva e destrutiva entre as diferentes regiões do aerofólio.

\subsubsection{Interação com múltiplas rajadas}

Um escoamento turbulento isotrópico é um processo estocástico, e pode ser decomposto em um espectro contínuo de rajadas turbulentas incoerentes - isto é, estatisticamente \emph{independentes} entre si. Portanto, a soma das contribuições de diferentes rajadas deve ser realizada de forma probabilística através das funções densidade espectral cruzada (CSD) da flutuação de pressão $S_{\Delta p \Delta p'}$ e do campo acústico $S_{pp'}$, que capturam as relações de magnitude e fase média destas grandezas entre dois pontos arbitrários.

A densidade espectral cruzada da flutuação de pressão $S_{\Delta p \Delta p'} (x_s, x_s', y_s, y_s', \omega)$ entre dois pontos $(x_s,y_s)$ e $(x_s', y_s')$ na superfície do aerofólio é dada por

\vspace{-15pt}
\begin{IEEEeqnarray}{rCl}
	S_{\Delta p \Delta p'} (x_s, x_s', y_s, y_s', \omega) & = & \lim_{T \rightarrow \infty} \left[ \frac{\pi}{T} \mathrm{E} \left\{ \Delta p(x_s, y_s, \omega) \Delta p^*(x_s', y_s', \omega) \right\} \right] \\
	& = &  (2 \pi \rho_0)^2 U_x \int_{-\infty}^{+\infty} \Phi_{ww}(\kappa_\chi, k_\psi) g(x_s, \kappa_\chi, k_\psi) g^*(x_s', \kappa_\chi, k_\psi) e^{-j k_\psi (y_s - y_s')} \ud k_\psi, \IEEEeqnarraynumspace
	\label{eq:SurfPressure_CSD}
\end{IEEEeqnarray}

\noindent onde $\Phi_{ww}(k_\chi, k_\psi)$ é a densidade espectral de número de onda da turbulência incidente. Observe que esta CSD é obtida a partir da integração sobre todos os números de onda laterais $k_\psi$ da turbulência, e portanto incorpora os efeitos de múltiplas rajadas.

Por sua vez, a densidade espectral cruzada do campo acústico $S_{pp'}(\mathbf{r}, \mathbf{r}', \omega)$ entre dois observadores em $\mathbf{r}$ e $\mathbf{r}'$ é dada por

\begin{IEEEeqnarray}{rCl}
	S_{pp'}(\mathbf{r}, \mathbf{r}', \omega) & = & \lim_{T \rightarrow \infty} \left[ \frac{\pi}{T} \mathrm{E} \left\{ p(\mathbf{r}, \omega) p^* (\mathbf{r}', \omega) \right\} \right] \\
	& = & \int_{-d}^{+d} \int_{-b}^{+b} \int_{-d}^{+d} \int_{-b}^{+b} S_{\Delta p \Delta p'} (\mathbf{r}_s, \mathbf{r}_s', \omega) \frac{\partial}{\partial z_s} G_{U_x} (\mathbf{r} | \mathbf{r}_s, \omega) \frac{\partial}{\partial z_s'} G^{*}_{U_x}(\mathbf{r}' | \mathbf{r}_s', \omega) \ud x_s \ud y_s \ud x_s' \ud y_s'. \IEEEeqnarraynumspace
	\label{eq:Spp_cross_freq}
\end{IEEEeqnarray}

\subsubsection{Densidade espectral de número de onda da turbulência}

Para a densidade espectral de número de onda da turbulência $\Phi_{ww}(k_\chi, k_\psi)$, pode-se por exemplo adotar o espectro energético de número de onda de von Karman \cite{Amiet75}, definido a partir da velocidade vertical média quadrática $\overline{w^2}$ e da escala de comprimento integral $\Lambda$ do escoamento. Esta densidade espectral possui a forma

\begin{equation}
	\Phi_{ww}(k_\chi, k_\psi) = \frac{4}{9 \pi} \frac{\overline{w^2}}{k_e^2} \frac{\check{k}_\chi^2 + \check{k}_\psi^2}{\left(1 + \check{k}_\chi^2 + \check{k}_\psi^2 \right)^{7/3}},
	\label{eq:vonKarmanModel}
\end{equation}

\begin{equation}
	k_e = \frac{\sqrt{\pi}}{\Lambda} \frac{\Gamma (5/6)}{\Gamma (1/3)},
\end{equation}

\noindent onde $\check{k}_i = k_i/k_e$ e $\Gamma (\cdot)$ é a função gama. Outros modelos, tais como o de Liepmann, também são possíveis.


%\subsection{Aproximações de envergadura infinita e observador distante}


% *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
\clearpage
\newpage
\section{Usando o pacote}

\subsection{Requerimentos}

O pacote \verb|amiet_tools| (abreviado por ``AmT'') foi desenvolvido em linguagem Python 3.x, e tem como dependências os pacotes \verb|numpy| e \verb|scipy|. Para plotar resultados, esse tutorial usa o pacote \verb|matplotlib|, mas esta não é uma dependência do AmT. Estes pacotes estão inclusos na ``\emph{Anaconda Python Distribution}''\footnote{Disponível em \url{https://www.anaconda.com/products/individual}.}, uma distribuição Python gratuita e de código aberto. A distribuição Anaconda é usada para desenvolver o pacote AmT, e é a distribuição recomendada para usar AmT.

%Assim como outros programas de computação científica, o pacote AmT exige  certos recursos computacionais. Por exemplo, um aerofólio cuja superfície é discretizada com $(N_x, N_y)$ pontos terá a sua matriz de espectro cruzado (CSM) com $(N_x \times N_y)^2$ números complexos de precisão dupla (\verb|numpy.complex128|, 128 bits por número complexo), ocupando $(N_x \times N_y)^2 \times 128$ bits de memória RAM \emph{por frequência}. A amostragem padrão do pacote AmT, com $N_x = 100$ e $N_y = 101$, resultará em uma CSM que ocupa aproximadamente 1.6 GB por frequência. 

\subsection{Definindo as variáveis}

\subsubsection{Inserindo variáveis experimentais - método recomendado}

O pacote AmT pode ler as variáveis relacionadas às condições do experimento e à geometria do aerofólio a partir de dois arquivos de texto. Usaremos como exemplo os dois arquivos de configuração do experimento ``DARP2016'', realizado no túnel de vento DARP da Universidade de Southampton, Reino Unido, e disponíveis no repositório GitHub do projeto.

O primeiro arquivo, chamado \verb|DARP2016_TestSetup.txt|, e os seus conteúdos estão indicados na listagem \ref{lst:TestSetup} abaixo; note que linhas vazias são ignoradas, e o caractere ``\#'' indica comentários. O programa lerá os valores em cada linha do arquivo, e os interpretará conforme indicado nas respectivas linhas. O arquivo deve conter as seguintes variáveis, listadas em ordem:

\begin{itemize}
	\item velocidade do som $c_0$ [m/s];
	\item densidade do ar $\rho_0$ [kg/m$^3$];
	\item pressão acústica de referência $p_{ref}$ [Pa RMS];
	\item velocidade do escoamento $U_x$ [m/s];
	\item intensidade de turbulência $\sqrt{\overline{w^2}}/U_x$ [adimensional];
	\item escala de comprimento de turbulência $\Lambda$ [m];
	\item altura da camada cisalhante $z_{sl}$ (para túnel de vento aberto) [m].
\end{itemize}

\begin{lstlisting}[caption={Arquivo \texttt{DARP2016\_TestSetup.txt}}, label={lst:TestSetup}, style=]
# amiet_tools Test Setup file
#
# DARP2016 test setup, ISVR, Univ. of Southampton, UK

# Acoustic characteristics
340.	# c0		Speed of sound [m/s]
1.2		# rho0		Air density [kg/m**3]
20e-6	# p_ref		Ref acoustic pressure [Pa RMS]

# turbulent flow properties
60		# Ux				flow velocity [m/s]
0.025	# turb_intensity	turbulence intensity = u_rms/U
0.007	# length_scale		turb length scale [m]

# shear layer height
-0.075	# z_sl			Shear layer height (aerofoil is at z=0) [m]
\end{lstlisting}

O segundo arquivo chama-se \verb|DARP2016AirfoilGeom.txt|, e contém variáveis relacionadas à geometria do aerofólio. Seus conteúdos estão indicados na listagem \ref{lst:AirfoilGeom} abaixo. Este arquivo deve conter as seguintes variáveis, listadas em ordem:

\begin{itemize}
	\item semi corda do aerofólio $b$ [m];
	\item semi envergadura do aerofólio $d$ [m];
	\item número de pontos para amostragem da corda (não uniforme) $N_x$;
	\item número de pontos para amostragem da envergadura (uniforme) $N_y$.
\end{itemize}

\begin{lstlisting}[caption={Arquivo \texttt{DARP2016\_AirfoilGeom.txt}}, label={lst:AirfoilGeom}, style=]
# amiet_tools AirfoilGeom file
#
# DARP2016 flat plate airfoil, ISVR, Univ. of Southampton, UK

0.075	# b			airfoil half chord [m]
0.225	# d 		airfoil half span [m]
100		# Nx 		number of chordwise points (non-uniform sampl)
101		# Ny 		number of spanwise points (uniform sampl)
\end{lstlisting}

Para carregar os valores descritos nos arquivos de texto, recomenda-se usar os comandos em Python descrito na listagem \ref{lst:LoadingVars}. Primeiramente, o pacote \verb|numpy| e o pacote AmT são importados pelo script. A função \verb|AmT.loadTestSetup| é usada para carregar as variáveis relacionadas às condições do experimento a partir do arquivo de texto fornecido como argumento, e cria um objeto - aqui chamado de \verb|DARP2016Setup| - para armazenar estas variáveis. Este objeto é uma instância da classe \verb|TestSetup|, definida no pacote AmT; mais informações sobre as classes usadas no pacote AmT podem ser encontradas na Seção \ref{sec:ClassDescription}.

Similarmente, usa-se a função \verb|AmT.loadAirfoilGeom| para carregar variáveis relacionadas à geometria do aerofólio a partir do arquivo de texto fornecido como argumento. Esta função criará um objeto - aqui chamado de \verb|DARP2016Airfoil| - para armazenar as dimensões do aerofólio e as configurações de amostragem de sua superfície. Este objeto é uma instância da classe \verb|AirfoilGeom|, definida no pacote AmT; mais informações sobre as classes usadas no pacote AmT podem ser encontradas na Seção \ref{sec:ClassDescription}.

\begin{lstlisting}[caption={Método recomendado para importar pacotes e carregar variáveis},label={lst:LoadingVars}]
import numpy as np
import amiet_tools as AmT

# load test setup from file
DARP2016Setup = AmT.loadTestSetup('../DARP2016_TestSetup.txt')

# load airfoil geometry from file
DARP2016Airfoil = AmT.loadAirfoilGeom('../DARP2016_AirfoilGeom.txt')
\end{lstlisting}

\subsubsection{Inserindo variáveis experimentais - método alternativo}

Alternativamente, estas funções podem ser chamadas sem nenhum argumento de entrada; os objetos resultantes conterão as configurações do teste ``DARP2016'' por padrão, e estes podem ser modificados posteriormente dentro do script. Um exemplo deste método alternativo encontra-se na listagem \ref{lst:AltLoadingVars}, onde três variáveis são modificadas e recebem novos valores. Note, porém, que é necessário executar os métodos internos \verb|MyTestSetup._calc_secondary_vars()| e \verb|MyAirfoil._calc_grid()| para recalcular as variáveis secundárias depois das variáveis primárias serem redefinidas.

\begin{lstlisting}[caption={Método alternativo para carregar variáveis},label={lst:AltLoadingVars}]
import amiet_tools as AmT

# Inicializando os objetos para armazenar variaveis
MyTestSetup = AmT.loadTestSetup()
MyAirfoil = AmT.loadAirfoilGeom()

# Definindo novos valores
MyTestSetup.Ux = 120
MyTestSetup.turb_intensity = 0.05
MyAirfoil.b = 0.15

# IMPORTANTE: recalcular as variaveis secundarias em ambos objetos
MyTestSetup._calc_secondary_vars()
MyAirfoil._calc_grid()
\end{lstlisting}

Desta forma, as diversas variáveis relacionadas ao setup experimental e ao aerofólio utilizado podem ser importadas e combinadas; por exemplo, pode-se simular dois aerofólios diferentes dentro das mesmas condições experimentais. 

\subsubsection{Acessando as variáveis experimentais}

As variáveis podem ser acessadas como atributos dos objetos criados: por exemplo, usa-se o comando \verb|DARP2016Setup.c0| para acessar a velocidade do som contida neste objeto. As variáveis também podem ser exportadas diretamente para o ``namespace'' atual utilizando o método \verb|export_values| (pertencente às duas classes), conforme indicado na listagem \ref{lst:ExportingVars}. Desta forma, as variáveis agora existem tanto como atributos dos objetos criados quanto como variáveis independentes dentro do namespace atual, facilitando certos cálculos.

\begin{lstlisting}[caption={Exportando as variáveis para o ``namespace'' atual},label={lst:ExportingVars}]
# exportando variaveis para o namespace atual
(c0, rho0, p_ref, Ux, turb_intensity, length_scale, z_sl, Mach, beta,
flow_param, dipole_axis) = DARP2016Setup.export_values()

(b, d, Nx, Ny, XYZ_airfoil, dx, dy) = DARP2016Airfoil.export_values()
\end{lstlisting}

\subsubsection{Definindo as variáveis temporais}

As variáveis relacionadas à frequência temporal $f$ (em Hz) são criadas dentro do próprio código, dependendo do interesse do usuário. Como exemplo, vamos definir uma única frequência $f_0$ a partir da frequência não dimensional normalizada pela corda $k_0 c = 5$. Para tal, definimos o valor desejado de $f_0$ (a partir da frequência não dimensional $k_0 c$), e passamos esta variável e o objeto \verb|DARP2016TestSetup| como argumentos para a função \verb|AmT.FrequencyVars|, resultando no objeto aqui chamado \verb|FreqVars|. Este objeto é uma instância da classe \verb|FrequencyVariables|, definida no pacote AmT; mais informações sobre as classes usadas no pacote AmT podem ser encontradas na Seção \ref{sec:ClassDescription}. Similarmente, os valores aqui calculados podem ser acessados como atributos do objeto \verb|FreqVars|, ou exportados para o namespace atual através do método \verb|FreqVars.export_values|.

\begin{lstlisting}[caption={Criando variáveis relacionadas à frequência},label={lst:FrequencyVars}]
# frequency of operation
kc = 5                          # chordwise normalised frequency = k0*(2*b)
f0 = kc*c0/(2*np.pi*(2*b))      # approx 1.8 kHz

FreqVars = AmT.FrequencyVars(f0, DARP2016Setup)
(k0, Kx, Ky_crit) = FreqVars.export_values()
\end{lstlisting}

Para cálculos envolvendo múltiplas frequências, recomenda-se realizar um loop sobre as frequências de interesse, e recalcular o objeto \verb|FreqVars| ao início de cada iteração.

% *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
\section{Exemplos}

\subsection{Exemplo 1: Interação de Rajada Única}

Como primeiro exemplo, vamos usar o pacote AmT para calcular a distribuição do ``salto'' de pressão $\Delta p(x_s, y_s)$ na superfície do aerofólio em resposta a uma única rajada turbulenta, e as funções de diretividade do campo acústico nas direções da corda e da envergadura.



% *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
\clearpage
\newpage
\section{Pseudocódigo}

O pseudocódigo usado para calcular o espectro cruzado $S_{\Delta p \Delta p'}$ da pressão de superfície do aerofólio e/ou o espectro cruzado $S_{pp'}$ do ruído radiado é mostrado abaixo, retirado de \cite{Casagrande_etal2020}. A maior parte das instruções mostradas abaixo possuem funções Python equivalentes ou métodos associados no pacote AmT, e não precisam ser implementadas pelo usuário final. Para mais detalhes sobre o uso destas funções, veja a documentação e os scripts de exemplo no pacote.

\begin{algorithm}
	\caption{Pseudocódigo para o modelo de predição de ruído de interação turbulência-aerofólio do pacote \texttt{amiet\_tools}}
	\label{alg:amiet_pseudocode}
	\begin{algorithmic}[1] % Define line numbers
		\State Definir as variáveis do ambiente de teste: $c_0, \rho_0, p_{ref}, U_x, \overline{w^2}, \Lambda, z_{sl}, M_x, \beta$
		\State Definir as variáveis da geometria do aerofólio: $b, d, N_x, N_y, \Delta x_s, \Delta y_s$
		\State Calcular a amostragem da corda do aerofólio $x_s[n], \ n \in [1, \ldots, N_x]$
		\State Calcular a amostragem da envergadura do aerofólio $y_s[n], \ n \in [1, \ldots, N_y]$
		\State Definir as coordenadas dos observadores $\mathbf{r}_m = (x_m, y_m, z_m), \ m \in [1, \ldots, M]$
		
		\If{usando correção de camada cisalhante}
		\ForAll{pares $(m, n)$ de pontos observador-aerofólio $(\mathbf{r}_m|\mathbf{r}_s)$}
		\State Calcular os pontos de cruzamento da camada cisalhante $\mathbf{r}_l(m, n)$ e tempos de propagação $\tau_{sm}(m, n)$
		\EndFor
		\EndIf
		
		\For{cada frequência $f \in [f_{min}, \ldots, f_{max}]$}
		\State Calcular $k_0, \kappa_\chi, k_\psi^{crit}$
		\State Calcular valores de números de onda de rajada $k_\psi \in [-k_\psi^{max}, k_\psi^{max}]$
		\State Calcular intervalo de amostragem dos números de onda de rajada $\Delta k_\psi$
		\State Calcular espectro de energia dos números de onda de rajada $\Phi_{ww}(k_\psi)$
		\State Calcular matriz $\partial G(\mathbf{r}_m|\mathbf{r}_s)/\partial z_s$ para todos os pares $(m, n)$ de pontos observador-aerofólio; 
		\State Inicializar $S_{\Delta p \Delta p'} \gets 0$
		\State Inicializar $S_{p p'} \gets 0$
		\For{cada rajada $k_\psi \in [-k_\psi^{max}, k_\psi^{max}]$}
		\State $w(k_\psi) \gets \sqrt{\Phi_{ww}(k_\psi)}$
		\State Calcular $\Delta p(x_s, y_s, k_\psi)$ usando $w(k_\psi)$ 
		\State $S_{\Delta p \Delta p'}(\mathbf{r}_s, \mathbf{r}_s') \gets S_{\Delta p \Delta p'}(\mathbf{r}_s, \mathbf{r}_s') + \left[ \Delta p(x_s, y_s, k_\psi) \cdot \Delta p^*(x_s', y_s', k_\psi) \right] \cdot U_x \cdot \Delta k_\psi$ \label{alg:crossproduct}
		\EndFor
		\State $S_{pp'}(\mathbf{r}_m, \mathbf{r}_{m'}) \gets 4 \pi \left[ S_{\Delta p \Delta p'} \cdot (\Delta x_s \cdot \Delta y_s) \cdot (\Delta x_s' \cdot \Delta y_s') \right] \cdot \left[ \partial G(\mathbf{r}_m|\mathbf{r}_s)/\partial z_s \right] \cdot \left[ \partial G(\mathbf{r}_{m'}|\mathbf{r}_s')/\partial z_s \right]$
		\EndFor
	\end{algorithmic}
\end{algorithm}

\clearpage
\newpage

% *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
\section{Descrição das classes}
\label{sec:ClassDescription}

O pacote \verb|amiet_tools| utiliza classes - i.e. estruturas de abstração usadas em programação orientada a objetos - para armazenar dados relacionados aos diferentes aspectos da simulação. As três classes utilizadas em AmT estão descritas abaixo, seguidas de uma lista de seus atributos:

\begin{itemize}
	\item Classe \verb|TestSetup|:
	\begin{itemize}
		\item \verb|TestSetup.c0|: velocidade do som em um meio em repouso $c_0$ (em m/s);
		\item \verb|TestSetup.rho0|: densidade do ar $\rho_0$ (em kg/m$^3$);
		\item \verb|TestSetup.p_ref|: pressão acústica de referência $p_{ref} = 20 \mu$Pa RMS;
		\item \verb|TestSetup.Ux|: velocidade média do escoamento $U_x$ (em m/s);
		\item \verb|TestSetup.turb_intensity|: intensidade da turbulência $\sqrt{\overline{w^2}}/U_x$;
		\item \verb|TestSetup.length_scale|: escala de comprimento de turbulência $\Lambda$ (em m);
		\item \verb|TestSetup.z_sl|: altura da camada cisalhante $z_{sl}$ (em m);
		\item \verb|TestSetup.flow_dir|: caractere único indicando a direção do escoamento (i.e. `\verb|x|' para indicar escoamento na direção $+x$);
		\item \verb|TestSetup.dipole_axis|: caractere único indicando a direção do eixo dos dipolos (i.e. `\verb|z|' para dipolos apontando ``para cima'', na direção $+z$);
		\item \verb|TestSetup.Mach|: número de Mach do escoamento $M_x = U_x/c_0$;
		\item \verb|TestSetup.beta|: fator de Prandtl-Glauert $\beta = \sqrt{1-M_x^2}$.
	\end{itemize}
	
	\item Classe \verb|AirfoilGeom|:
	\begin{itemize}
		\item \verb|AirfoilGeom.b|: semi corda do aerofólio $b = c/2$ (em m);
		\item \verb|AirfoilGeom.d|: semi envergadura do aerofólio $d = L/2$ (em m);
		\item \verb|AirfoilGeom.Nx|: número de amostras sobre a corda $N_x$, amostragem não-uniforme;
		\item \verb|AirfoilGeom.Ny|: número de amostras sobre a envergadura $N_y$, amostragem uniforme;
		\item \verb|AirfoilGeom.dx|: intervalos de amostragem sobre a corda $\Delta x_s$  (calculado internamente)
		\item \verb|AirfoilGeom.dy|: intervalo de amostragem sobre a envergadura $\Delta y_s$  (calculado internamente).
	\end{itemize}
	
	\item Classe \verb|FrequencyVariables|:
	\begin{itemize}
		\item \verb|FrequencyVariables.freq|: frequência $f$ (em Hz);
		\item \verb|FrequencyVariables.k0|: número de onda acústico $k_0 = 2 \pi f/c_0$;
		\item \verb|FrequencyVariables.Kx|: número de onda de rajada na direção da corda $\kappa_\chi = \omega/U_x$;
		\item \verb|FrequencyVariables.Ky_crit|: número de onda crítico de rajada na direção da envergadura $k_\psi^{crit}$.
	\end{itemize}
\end{itemize}

Uma instância de cada classe é criada para armazenar os valores das variáveis relacionados às condições de um experimento e para passá-las às diferentes funções no pacote. Valores numéricos podem ser atribuídos diretamente através de um script em Python, ou podem ser lidos em um arquivo externo através das funções \verb|loadTestSetup| e \verb|loadAirfoilGeom|. 

Uma quarta classe chamada \verb|MicArrayCsmHDF5| também está inclusa no pacote, e permite a leitura e escrita de dados de CSM de arranjos de microfones no formato HDF5 adotado pela comunidade ``Array Methods'' \cite{Bahr_etal2017, Sarradj_etal2017} para compartilhar dados de ``beamforming''.

% *-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-*-
\clearpage
\newpage
\label{Bibliography}
\bibliographystyle{unsrtnat} 
\bibliography{../Bibliography} 
\end{document}
